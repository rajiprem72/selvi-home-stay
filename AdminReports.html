<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Reports - Selvi Home Stay</title>

<link rel="stylesheet" href="style.css">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

.admin-container {
  max-width: 1000px;
  margin: 40px auto;
  padding: 20px;
}

button {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

th {
  background: #f2f2f2;
}

.mark-btn {
  padding: 6px 10px;
  background: green;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}

/* Calendar Styles */
.calendar-container {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.month {
  border: 1px solid #ccc;
  padding: 10px;
  flex: 1;
  min-width: 280px;
}

.month h3 {
  text-align: center;
}

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
}

.day-name {
  font-weight: bold;
  text-align: center;
}

.day {
  padding: 8px;
  text-align: center;
  border-radius: 5px;
  font-size: 13px;
}

.free {
  background-color: #4CAF50;
  color: white;
}

.booked-light {
  background-color: #64B5F6;
  color: white;
}

.booked-dark {
  background-color: #1976D2;
  color: white;
}

.outside-range {
  background-color: #eee;
  color: #999;
}

@media (max-width: 768px) {
  .calendar-container {
    flex-direction: column;
  }
}
</style>
</head>

<body>

<div id="nav-placeholder"></div>

<div class="admin-container">

<h2>Admin Reports</h2>

<!-- ================= MENU SECTION ================= -->
<div id="adminMenu">

<button onclick="location.href='GuestDetails.html'">
1. Guest Details
</button>

<button onclick="location.href='UpdatePayments.html'">
2. Update Payments
</button>

<button onclick="location.href='CreateInvoice.html'">
3. Create Invoice
</button>  

<button onclick="loadCommissionData()">
4. Commission Ledger (Pay Commission & Click )
</button>

<button onclick="sendWelcomeEmails()">
5. Send Welcome Email (Tomorrow Arrivals)
</button>

<button onclick="showCalendar()">
6. Booking Calendar (Next 60 Days)
</button>

<div id="welcomeReport"></div>
<div id="commissionSection"></div>

</div>


<!-- ================= CALENDAR SECTION ================= -->
<div id="calendarSection" style="display:none;">

<button onclick="showMenu()">â¬… Back to Admin Menu</button>

<h3>Booking Calendar (Next 60 Days)</h3>

<div id="calendarContainer" class="calendar-container"></div>

</div>

</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbxJJUirnar3OBGwszagDNWH_Js0FhYfzKMYyRVl06bH4IOseYcZ3vIRr6izAHERWqko/exec";

/* ===================== MENU SWITCH ===================== */

function showCalendar() {
  document.getElementById("adminMenu").style.display = "none";
  document.getElementById("calendarSection").style.display = "block";
  loadBookings();
}

function showMenu() {
  document.getElementById("calendarSection").style.display = "none";
  document.getElementById("adminMenu").style.display = "block";
}

/* ===================== CALENDAR LOGIC ===================== */
function loadBookings() {

  document.getElementById("calendarContainer").innerHTML = "Loading...";

  fetch(API_URL + "?action=get_bookings")
  .then(res => res.json())
  .then(response => {

  const bookings = response.data || [];
  bookings.sort((a, b) => {
  return new Date(a.checkin) - new Date(b.checkin);
});
  

  if (!Array.isArray(bookings)) {
    document.getElementById("calendarContainer").innerHTML =
      "No booking data available.";
    return;
  }


    console.log(bookings);   // ðŸ”¥ check browser console

    if (!bookings || bookings.length === 0) {
      document.getElementById("calendarContainer").innerHTML = 
        "<p>No bookings found.</p>";
      return;
    }

    document.getElementById("calendarContainer").innerHTML = "";

    const today = new Date();
    today.setHours(0,0,0,0);

    const maxDate = new Date();
    maxDate.setDate(today.getDate() + 60);
    maxDate.setHours(0,0,0,0);

    const months = getMonthsInRange(today, maxDate);

    months.forEach(m => {
      createMonth(m.month, m.year, bookings, today, maxDate);
    });

  })
  .catch(err => {
    document.getElementById("calendarContainer").innerHTML =
      "Error loading bookings.";
    console.error(err);
  });
}


function getMonthsInRange(start, end) {
  let months = [];
  let current = new Date(start.getFullYear(), start.getMonth(), 1);

  while (current <= end) {
    months.push({
      month: current.getMonth(),
      year: current.getFullYear()
    });
    current.setMonth(current.getMonth() + 1);
  }
  return months;
}

function createMonth(month, year, bookings, today, maxDate) {

  const container = document.getElementById("calendarContainer");

  const monthDiv = document.createElement("div");
  monthDiv.className = "month";

  const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });
  monthDiv.innerHTML = `<h3>${monthName} ${year}</h3>`;

  const calendar = document.createElement("div");
  calendar.className = "calendar";

  const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

  dayNames.forEach(day => {
    const d = document.createElement("div");
    d.className = "day-name";
    d.innerText = day;
    calendar.appendChild(d);
  });

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) {
    calendar.appendChild(document.createElement("div"));
  }

  for (let day = 1; day <= daysInMonth; day++) {

    const currentDate = new Date(year, month, day);
    currentDate.setHours(0,0,0,0);

    const dateStr =
    currentDate.getFullYear() + "-" +
    String(currentDate.getMonth() + 1).padStart(2, '0') + "-" +
    String(currentDate.getDate()).padStart(2, '0');


    const dayDiv = document.createElement("div");
    dayDiv.className = "day";
    dayDiv.innerText = day;

    if (currentDate < today || currentDate > maxDate) {
      dayDiv.classList.add("outside-range");
    } else {

      let bookingIndex = -1;

      bookings.forEach((booking, index) => {
        if (dateStr >= booking.checkin && dateStr < booking.checkout) {
          bookingIndex = index;
        }
      });

      if (bookingIndex >= 0) {
        dayDiv.classList.add(
          bookingIndex % 2 === 0 ? "booked-light" : "booked-dark"
        );
      } else {
        dayDiv.classList.add("free");
      }
    }

    calendar.appendChild(dayDiv);
  }

  monthDiv.appendChild(calendar);
  container.appendChild(monthDiv);
}

/* ===================== EXISTING FUNCTIONS (UNCHANGED) ===================== */

/* Commission + Welcome code remains exactly as your original */

</script>

<script src="script.js"></script>

</body>
</html>
