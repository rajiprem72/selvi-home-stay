<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create Invoice - Selvi Home Stay</title>

<link rel="stylesheet" href="style.css">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

.page-container {
  max-width: 700px;
  margin: 40px auto;
  padding: 20px;
}

h2 {
  margin-bottom: 20px;
}

input, button {
  padding: 10px;
  width: 100%;
  margin: 10px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button {
  background-color: #f59e0b;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background-color: #d97706;
}

#result {
  margin-top: 20px;
}
</style>
</head>

<body>

<!-- Navbar -->
<div id="nav-placeholder"></div>

<!-- Page Content -->
<div class="page-container">

<h2>Create Invoice</h2>

<input type="text" id="bookingId" placeholder="Enter Booking ID">

<button onclick="fetchInvoice()">Fetch Details</button>

<div id="result"></div>

</div>

<script>

const API_URL =
"https://script.google.com/macros/s/AKfycbxJJUirnar3OBGwszagDNWH_Js0FhYfzKMYyRVl06bH4IOseYcZ3vIRr6izAHERWqko/exec";

function fetchInvoice() {

  const bookingId = document.getElementById("bookingId").value;

  fetch(API_URL + "?action=get_invoice_data&bookingId=" + bookingId)
  .then(res => res.json())
  .then(data => {

    if (!data.success) {
      alert("Booking not found");
      return;
    }

    const d = data.data;

    document.getElementById("result").innerHTML = `
      <p><b>Booking ID:</b> ${d.bookingId}</p>
      <p><b>Date:</b> ${d.date}</p>
      <p><b>Name:</b> ${d.name}</p>
      <p><b>From:</b> ${d.fromDate}</p>
      <p><b>To:</b> ${d.toDate}</p>
      <p><b>Days:</b> ${d.days}</p>
      <p><b>Base Amount:</b> ₹${d.baseAmount}</p>
      <p><b>Discount:</b> ₹${d.discount}</p>
      <p><b>Net Amount:</b> ₹${d.netAmount}</p>
      <p><b>Advance Paid:</b> ₹${d.advance}</p>
      <p><b>Balance Paid:</b> ₹${d.balancePaid}</p>
      <p><b>Email:</b> ${d.email}</p>

      <button onclick="sendInvoice('${d.bookingId}')">
        Send Email with Invoice
      </button>
    `;
  });
}

function sendInvoice(bookingId) {

  const formData = new URLSearchParams();
  formData.append("action", "send_invoice");
  formData.append("bookingId", bookingId);

  fetch(API_URL, {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {

    if (data.success) {
      alert("Invoice sent successfully!");
    } else {
      alert("Error: " + (data.error || JSON.stringify(data)));
    }

  });
}

</script>

<script src="script.js"></script>

</body>
</html>
